(()=>{"use strict";const e=(e,t,r)=>{const n=e.children;if(r){e.classList.remove(`${t}--disabled`);for(let e of n)e.disabled=!1}else{e.classList.add(`${t}--disabled`);for(let e of n)e.disabled=!0}},t=t=>{const r=document.querySelector(".ad-form"),n=document.querySelector(".map__filters");e(r,"ad-form",t),e(n,"map__filters",t)},r=(e,t,r=[2,0,1,1,1,2])=>t[e%100>4&&e%100<20?2:r[e%10<5?e%10:5]],n=e=>"Escape"===e.key||"Esc"===e.key,o=(e,t)=>{let r;return function(){const n=()=>{e.apply(this,arguments)};clearTimeout(r),r=setTimeout(n,t)}},a=["комната","комнаты","комнат"],c=["гостя","гостей","гостей"],l={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало"},i=35.6824,u=139.75176,s=40;t(!1);const d=L.map("map-canvas").on("load",(()=>{t(!0)})).setView({lat:i,lng:u},13);let p;L.tileLayer("http://{s}.tiles.maps.sputnik.ru/{z}/{x}/{y}.png",{attribution:'Map data: © <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors, under ODbL | Tiles: © <a href="http://maps.sputnik.ru/" target="_blank">Спутник</a>'}).addTo(d);const m=e=>{const t=x(e);p=L.layerGroup(),t.forEach((e=>{((e,t)=>{const n=L.icon({iconUrl:"../img/pin.svg",iconSize:[s,s],iconAnchor:[20,s]}),o=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:n});o.addTo(t),o.bindPopup((e=>{const{offer:t,author:n}=e,{title:o,address:i,price:u,type:s,rooms:d,guests:p,checkin:m,checkout:y,features:g,description:h,photos:v}=t,{avatar:f}=n,S=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);S.querySelector(".popup__avatar").src=f,S.querySelector(".popup__title").textContent=o,S.querySelector(".popup__text--address").textContent=i,S.querySelector(".popup__text--price").innerHTML=`${u} <span>₽/ночь</span`,S.querySelector(".popup__type").textContent=l[s],S.querySelector(".popup__text--capacity").textContent=`${d} ${r(d,a)} для ${p} ${r(p,c)}`,S.querySelector(".popup__text--time").textContent=`Заезд после ${m}, выезд до ${y}`,S.querySelector(".popup__description").textContent=h;const _=S.querySelector(".popup__features");_.innerHTML="";const q=((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const n=`${t}--${e}`,o=document.createElement("li");o.classList.add(t,n),r.appendChild(o)})),r})(g,"popup__feature");_.appendChild(q);const L=S.querySelector(".popup__photo"),E=S.querySelector(".popup__photos");return E.innerHTML="",E.appendChild(((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const n=t.cloneNode(!0);n.src=e,r.appendChild(n)})),r})(v,L)),(e=>{const t=e.children;for(let e of t)e.hasChildNodes()||"IMG"===e.tagName||e.remove();return e})(S)})(e))})(e,p)})),p.addTo(d)},y=document.querySelector(".map__filters"),g=y.querySelector("#housing-type"),h=y.querySelector("#housing-price"),v=y.querySelector("#housing-rooms"),f=y.querySelector("#housing-guests"),S=y.querySelector("#housing-features"),_=1e9,q={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:_},any:{min:0,max:_}},E="any",k=e=>{const{offer:t}=e,{price:r,type:n,rooms:o,guests:a,features:c}=t,l=S.querySelectorAll(".map__checkbox:checked");let i=!0;if(g.value===E&&h.value===E&&v.value===E&&f.value===E&&0===l.length)return!0;if(g.value!==E&&g.value!==n)return!1;if(v.value!==E&&+v.value!==o)return!1;if(f.value!==E&&a!==+f.value)return!1;const u=h.value;return!(q[u].min>=r||q[u].max<r)&&(i=((e,t)=>{if(0===e.length)return!0;if(e.length>t.length)return!1;for(const r of e)if(!t.includes(r.value))return!1;return!0})(l,c),i)},x=e=>{const t=[];let r=0;for(let n=0;n<e.length;n++){let o=e[n];if(k(o)&&(t.push(o),r++),r>10)return t}return t},w="https://22.javascript.pages.academy/keksobooking",C=document.querySelector("#success").content.querySelector(".success"),b=document.querySelector("#error").content.querySelector(".error"),$=document.querySelector("main"),T=e=>{const t=b.cloneNode(!0);t.querySelector(".error__message").textContent=e,t.style.zIndex="1000",$.appendChild(t);const r=e=>{n(e)&&(t.remove(),document.removeEventListener("keydown",r))};t.addEventListener("click",(()=>{t.remove(),document.removeEventListener("keydown",r)})),document.addEventListener("keydown",r)},V=document.querySelector(".ad-form-header__preview"),D=document.querySelector(".ad-form-header__input"),M=document.querySelector(".ad-form__photo"),F=document.querySelector(".ad-form__input"),N=["image/jpg","image/png","image/svg","image/jpeg","image/svg+xml"],z=(e,t)=>{const r=e.files[0],n=r.type,o=N.includes(n);if(0===t.children.length&&o&&t.appendChild(((e="",t="50",r="50")=>{const n=document.createElement("img");return n.src="",n.alt=e,n.width=t,n.height=r,n})("Фотография вашего объекта",70,70)),o){const e=new FileReader;e.addEventListener("load",(()=>{t.children[0].src=e.result})),e.readAsDataURL(r)}},A=()=>{V.querySelector("img").src="img/muffin-grey.svg",M.innerHTML=""};F.addEventListener("change",(()=>z(F,M))),D.addEventListener("change",(()=>z(D,V)));const O={palace:"10000",flat:"1000",house:"5000",bungalow:"0"},j=document.querySelector(".ad-form"),H=(()=>{const e=L.icon({iconUrl:"../img/main-pin.svg",iconSize:[s,s],iconAnchor:[20,s]}),t=L.marker({lat:i,lng:u},{draggable:!0,icon:e});return t.addTo(d),t})(),U=j.querySelector("#type"),I=j.querySelector("#price"),P=j.querySelector("#timein"),G=j.querySelector("#timeout"),R=j.querySelector("#address"),B=j.querySelector("#title"),J=j.querySelector("#room_number"),K=j.querySelector("#capacity"),Q=j.querySelector(".ad-form__reset"),W=()=>{const e=H.getLatLng();R.value=`${e.lat.toFixed(5)} ${e.lng.toFixed(5)}`},X=e=>{P.value=e.target.value,G.value=e.target.value},Y=()=>{I.placeholder=O[U.value],I.min=O[U.value]},Z=()=>{const e=K.children,t=K.children,r=Array.from(t);0==+J.value?K.value=100:K.value=J.value;for(const t of e)t.style.display="block";r.forEach((e=>{+J.value<+e.value&&(e.style.display="none"),0==+J.value&&100==+e.value&&(e.style.display="block")}))},ee=()=>{(()=>{const e=C.cloneNode(!0);e.style.zIndex="1000",$.appendChild(e);const t=r=>{n(r)&&(e.remove(),document.removeEventListener("keydown",t))};e.addEventListener("click",(()=>{e.remove(),document.removeEventListener("keydown",t)})),document.addEventListener("keydown",t)})(),j.reset(),W()},te=()=>T("Ошибка размещения объявления");var re,ne;B.addEventListener("input",o((e=>{const t=e.target.value;t.length<30?e.target.setCustomValidity(`Введите еще  ${30-t.length} сим.`):t.length>100?e.target.setCustomValidity(`Слишком длинное название удалите:  ${t.length-100} сим.`):e.target.setCustomValidity(""),e.target.reportValidity()}),500)),I.addEventListener("input",(e=>{e.target.validity.rangeOverflow?e.target.setCustomValidity(`Стоимость не должна быть больше ${e.target.max}`):e.target.validity.rangeUnderflow?e.target.setCustomValidity(`Стоимость не должна быть меньше ${e.target.min}`):e.target.setCustomValidity(""),e.target.reportValidity()})),P.addEventListener("change",X),G.addEventListener("change",X),U.addEventListener("change",Y),J.addEventListener("change",Z),j.addEventListener("submit",(e=>{var t,r,n;e.preventDefault(),A(),t=ee,r=te,n=new FormData(e.target),fetch(w,{method:"POST",body:n}).then((e=>{if(!e.ok)throw new Error;t()})).catch((()=>{r()}))})),Q.addEventListener("click",(e=>{e.preventDefault(),j.reset(),d.setView({lat:i,lng:u},13),H.setLatLng([i,u]),A()})),H.on("move",W),R.readOnly=!0,W(),Y(),Z(),re=e=>{m(e),(e=>{y.addEventListener("change",o((()=>{(e=>{d.removeLayer(p),d.closePopup(),m(e)})(e)}),500))})(e)},ne=e=>T(e),fetch(`${w}/data`).then((e=>e.json())).then((e=>{re(e)})).catch((()=>ne("Ошибка при загрузке данных")))})();
//# sourceMappingURL=main.bundle.js.map