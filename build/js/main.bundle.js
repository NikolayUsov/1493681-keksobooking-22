(()=>{"use strict";const e=(e,t,r)=>{const n=e.children;if(r){e.classList.remove(`${t}--disabled`);for(let e of n)e.disabled=!1}else{e.classList.add(`${t}--disabled`);for(let e of n)e.disabled=!0}},t=t=>{const r=document.querySelector(".ad-form"),n=document.querySelector(".map__filters");e(r,"ad-form",t),e(n,"map__filters",t)},r=(e,t,r=[2,0,1,1,1,2])=>t[e%100>4&&e%100<20?2:r[e%10<5?e%10:5]],n=e=>"Escape"===e.key||"Esc"===e.key,o=(e,t)=>{let r;return function(){const n=()=>{e.apply(this,arguments)};clearTimeout(r),r=setTimeout(n,t)}},a=["комната","комнаты","комнат"],c=["гостя","гостей","гостей"],l={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало"},u=35.6824,i=139.75176,s=40;t(!1);const d=L.map("map-canvas").on("load",(()=>{t(!0)})).setView({lat:u,lng:i},13);let p;L.tileLayer("http://{s}.tiles.maps.sputnik.ru/{z}/{x}/{y}.png",{attribution:'Map data: © <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors, under ODbL | Tiles: © <a href="http://maps.sputnik.ru/" target="_blank">Спутник</a>'}).addTo(d);const m=e=>{const t=x(e);p=L.layerGroup(),t.forEach((e=>{((e,t)=>{const n=L.icon({iconUrl:"../img/pin.svg",iconSize:[s,s],iconAnchor:[20,s]}),o=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:n});o.addTo(t),o.bindPopup((e=>{const{offer:t,author:n}=e,{title:o,address:u,price:i,type:s,rooms:d,guests:p,checkin:m,checkout:y,features:g,description:h,photos:v}=t,{avatar:f}=n,_=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);_.querySelector(".popup__avatar").src=f,_.querySelector(".popup__title").textContent=o,_.querySelector(".popup__text--address").textContent=u,_.querySelector(".popup__text--price").innerHTML=`${i} <span>₽/ночь</span`,_.querySelector(".popup__type").textContent=l[s],_.querySelector(".popup__text--capacity").textContent=`${d} ${r(d,a)} для ${p} ${r(p,c)}`,_.querySelector(".popup__text--time").textContent=`Заезд после ${m}, выезд до ${y}`,_.querySelector(".popup__description").textContent=h;const S=_.querySelector(".popup__features");S.innerHTML="";const q=((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const n=`${t}--${e}`,o=document.createElement("li");o.classList.add(t,n),r.appendChild(o)})),r})(g,"popup__feature");S.appendChild(q);const L=_.querySelector(".popup__photo"),E=_.querySelector(".popup__photos");return E.innerHTML="",E.appendChild(((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const n=t.cloneNode(!0);n.src=e,r.appendChild(n)})),r})(v,L)),_})(e))})(e,p)})),p.addTo(d)},y=document.querySelector(".map__filters"),g=y.querySelector("#housing-type"),h=y.querySelector("#housing-price"),v=y.querySelector("#housing-rooms"),f=y.querySelector("#housing-guests"),_=y.querySelector("#housing-features"),S=1e9,q={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:S},any:{min:0,max:S}},E="any",k=e=>{const{offer:t}=e,{price:r,type:n,rooms:o,guests:a,features:c}=t,l=_.querySelectorAll(".map__checkbox:checked");let u=!0;if(g.value===E&&h.value===E&&v.value===E&&f.value===E&&0===l.length)return!0;if(g.value!==E&&g.value!==n)return!1;if(v.value!==E&&+v.value!==o)return!1;if(f.value!==E&&a!==+f.value)return!1;const i=h.value;return!(q[i].min>=r||q[i].max<r)&&(u=((e,t)=>{if(0===e.length)return!0;if(e.length>t.length)return!1;for(const r of e)if(!t.includes(r.value))return!1;return!0})(l,c),u)},x=e=>{const t=[];let r=0;for(let n=0;n<e.length;n++){let o=e[n];if(k(o)&&(t.push(o),r++),r>10)return t}return t},w="https://22.javascript.pages.academy/keksobooking",b=document.querySelector("#success").content.querySelector(".success"),C=document.querySelector("#error").content.querySelector(".error"),$=document.querySelector("main"),T=e=>{const t=C.cloneNode(!0);t.querySelector(".error__message").textContent=e,t.style.zIndex="1000",$.appendChild(t);const r=e=>{n(e)&&(t.remove(),document.removeEventListener("keydown",r))};t.addEventListener("click",(()=>{t.remove(),document.removeEventListener("keydown",r)})),document.addEventListener("keydown",r)},V={palace:"10000",flat:"1000",house:"5000",bungalow:"0"},D=document.querySelector(".ad-form"),F=(()=>{const e=L.icon({iconUrl:"../img/main-pin.svg",iconSize:[s,s],iconAnchor:[20,s]}),t=L.marker({lat:u,lng:i},{draggable:!0,icon:e});return t.addTo(d),t})(),z=D.querySelector("#type"),A=D.querySelector("#price"),M=D.querySelector("#timein"),O=D.querySelector("#timeout"),j=D.querySelector("#address"),N=D.querySelector("#title"),U=D.querySelector("#room_number"),H=D.querySelector("#capacity"),P=D.querySelector(".ad-form__reset"),I=()=>{const e=F.getLatLng();j.value=`${e.lat.toFixed(5)} ${e.lng.toFixed(5)}`},R=e=>{M.value=e.target.value,O.value=e.target.value},G=()=>{A.placeholder=V[z.value],A.min=V[z.value]},B=()=>{const e=H.children,t=H.children,r=Array.from(t);0==+U.value?H.value=100:H.value=U.value;for(const t of e)t.style.display="block";r.forEach((e=>{+U.value<+e.value&&(e.style.display="none"),0==+U.value&&100==+e.value&&(e.style.display="block")}))},J=()=>{(()=>{const e=b.cloneNode(!0);e.style.zIndex="1000",$.appendChild(e);const t=r=>{n(r)&&(e.remove(),document.removeEventListener("keydown",t))};e.addEventListener("click",(()=>{e.remove(),document.removeEventListener("keydown",t)})),document.addEventListener("keydown",t)})(),D.reset(),I()},K=()=>T("Ошибка размещения объявления");N.addEventListener("input",o((e=>{const t=e.target.value;t.length<30?e.target.setCustomValidity(`Введите еще  ${30-t.length} сим.`):t.length>100?e.target.setCustomValidity(`Слишком длинное название удалите:  ${t.length-100} сим.`):e.target.setCustomValidity(""),e.target.reportValidity()}),500)),A.addEventListener("input",(e=>{e.target.validity.rangeOverflow?e.target.setCustomValidity(`Стоимость не должна быть больше ${e.target.max}`):e.target.validity.rangeUnderflow?e.target.setCustomValidity(`Стоимость не должна быть меньше ${e.target.min}`):e.target.setCustomValidity(""),e.target.reportValidity()})),M.addEventListener("change",R),O.addEventListener("change",R),z.addEventListener("change",G),U.addEventListener("change",B),D.addEventListener("submit",(e=>{var t,r,n;e.preventDefault(),t=J,r=K,n=new FormData(e.target),fetch(w,{method:"POST",body:n}).then((e=>{if(!e.ok)throw new Error;t()})).catch((()=>{r()}))})),P.addEventListener("click",(e=>{e.preventDefault(),D.reset(),d.setView({lat:u,lng:i},13),F.setLatLng([u,i])})),F.on("move",I),j.readOnly=!0,I(),G(),B();const Q=document.querySelector(".ad-form-header__preview"),W=document.querySelector(".ad-form-header__input"),X=document.querySelector(".ad-form__photo"),Y=document.querySelector(".ad-form__input"),Z=["image/jpg","image/png","image/svg","image/jpeg","image/svg+xml"],ee=(e,t)=>{const r=e.files[0],n=r.type,o=Z.includes(n);if(0===t.children.length&&o&&t.appendChild(((e="",t="50",r="50")=>{const n=document.createElement("img");return n.src="",n.alt=e,n.width=t,n.height=r,n})("Фотография вашего объекта",70,70)),o){const e=new FileReader;e.addEventListener("load",(()=>{t.children[0].src=e.result})),e.readAsDataURL(r)}};var te,re;Y.addEventListener("change",(()=>ee(Y,X))),W.addEventListener("change",(()=>ee(W,Q))),te=e=>{m(e),(e=>{y.addEventListener("change",o((()=>{(e=>{d.removeLayer(p),d.closePopup(),m(e)})(e)}),500))})(e)},re=e=>T(e),fetch(`${w}/data`).then((e=>e.json())).then((e=>{te(e)})).catch((()=>re("Ошибка при загрузке данных")))})();
//# sourceMappingURL=main.bundle.js.map